<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=PingFang SC:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zhangruochi.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"hide","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="What I have done today. Docker deployment with proxy; TFserving deployment with docker; model deployment with TFserving; client send requests to server and get response.">
<meta property="og:type" content="article">
<meta property="og:title" content="Debris 20190509">
<meta property="og:url" content="https://zhangruochi.com/Debris-20190509/2019/05/09/index.html">
<meta property="og:site_name" content="RUOCHI.AI">
<meta property="og:description" content="What I have done today. Docker deployment with proxy; TFserving deployment with docker; model deployment with TFserving; client send requests to server and get response.">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://zhangruochi.com/Debris-20190509/2019/05/09/TFserving.png">
<meta property="article:published_time" content="2019-05-09T02:01:08.000Z">
<meta property="article:modified_time" content="2020-04-21T04:38:59.888Z">
<meta property="article:author" content="Ruochi Zhang">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://zhangruochi.com/Debris-20190509/2019/05/09/TFserving.png">

<link rel="canonical" href="https://zhangruochi.com/Debris-20190509/2019/05/09/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'en'
  };
</script>

  <title>Debris 20190509 | RUOCHI.AI</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">RUOCHI.AI</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>Archives</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>About</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container"></div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="algolia-results">
  <div id="algolia-stats"></div>
  <div id="algolia-hits"></div>
  <div id="algolia-pagination" class="algolia-pagination"></div>
</div>

      
    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangruochi.com/Debris-20190509/2019/05/09/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Ruochi Zhang">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="RUOCHI.AI">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Debris 20190509
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-05-09 10:01:08" itemprop="dateCreated datePublished" datetime="2019-05-09T10:01:08+08:00">2019-05-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-04-21 12:38:59" itemprop="dateModified" datetime="2020-04-21T12:38:59+08:00">2020-04-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Private/" itemprop="url" rel="index"><span itemprop="name">Private</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">Views: </span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/Debris-20190509/2019/05/09/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/Debris-20190509/2019/05/09/" itemprop="commentCount"></span>
    </a>
  </span>
  
  
            <div class="post-description">What I have done today. Docker deployment with proxy; TFserving deployment with docker; model deployment with TFserving; client send requests to server and get response.</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="docker-deployment">Docker deployment</h2>
<p>The Docker daemon uses the HTTP_PROXY, HTTPS_PROXY, and NO_PROXY environmental variables in its start-up environment to configure HTTP or HTTPS proxy behavior. If your compant use a proxy, you need to change the setting of proxy in docker.</p>
<ol type="1">
<li><p>edit the http-proxy.conf <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nano /etc/systemd/system/docker.service.d/http-proxy.conf</span><br><span class="line">[Service]</span><br><span class="line">Environment=<span class="string">&quot;HTTP_PROXY=http://ip:port&quot;</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>edit daemon.json</p></li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo nano /etc/docker/daemon.json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;registry-mirrors&quot;</span>:[<span class="string">&quot;https://docker.mirrors.ustc.edu.cn&quot;</span>,<span class="string">&quot;http://hub-mirror.c.163.com&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li><p>sudo systemctl daemon-reload</p></li>
<li><p>sudo systemctl restart docker</p></li>
</ol>
<p><strong>if not work</strong></p>
<ol type="1">
<li>check the version of docker</li>
<li>downgrade the version to</li>
</ol>
<h2 id="tfserving">TFserving</h2>
<p>Once we have our Tensorflow or Keras based model trained, we needs to think on how to use it in, deploy it in production. we may want to Dockerize it as a micro-service, implementing a custom GRPC (or REST- or not) interface. Then deploy this to server or Kubernetes cluster and have other client micro-services calling it. Google Tensorflow Serving library helps here, to save our model to disk, and then load and serve a <strong>GRPC</strong> or <strong>RESTful</strong> interface to interact with it.</p>
<figure>
<img src="TFserving.png" alt="TFserving.png" /><figcaption aria-hidden="true">TFserving.png</figcaption>
</figure>
<h3 id="deploy-docker-environment-of-tfserving">Deploy docker environment of TFserving</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull tensorflow/serving</span><br></pre></td></tr></table></figure>
<h3 id="download-example-code">download example code</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /tmp/tfserving</span><br><span class="line"><span class="built_in">cd</span> /tmp/tfserving</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/tensorflow/serving</span><br></pre></td></tr></table></figure>
<h3 id="restful-api">RESTful API</h3>
<ol type="1">
<li>run TFserving</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 8501:8501 \</span><br><span class="line">  --mount <span class="built_in">type</span>=<span class="built_in">bind</span>,\</span><br><span class="line">   <span class="built_in">source</span>=/tmp/tfserving/serving/tensorflow_serving/servables/tensorflow/testdata/saved_model_half_plus_two_cpu,\</span><br><span class="line">target=/models/half_plus_two \</span><br><span class="line">-e MODEL_NAME=half_plus_two -t tensorflow/serving &amp;</span><br></pre></td></tr></table></figure>
<ol start="2" type="1">
<li>run Client</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -d <span class="string">&#x27;&#123;&quot;instances&quot;: [1.0, 2.0, 5.0]&#125;&#x27;</span> \</span><br><span class="line">  -X POST http://localhost:8501/v1/models/half_plus_two:predict </span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>result</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="string">&quot;predictions&quot;</span>: [2.5, 3.0, 4.5] &#125;</span><br></pre></td></tr></table></figure>
<h3 id="gprc-api">gPRC API</h3>
<ol type="1">
<li>run a mnist model and save the model</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 mnist_saved_model.py models/mnist</span><br></pre></td></tr></table></figure>
<p>source code - rain a model - Save the model we have trained</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> os</span><br><span class="line">    <span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">    <span class="comment"># This is a placeholder for a Google-internal import.</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> mnist_input_data</span><br><span class="line"></span><br><span class="line">    tf.app.flags.DEFINE_integer(<span class="string">&#x27;training_iteration&#x27;</span>, <span class="number">1000</span>,</span><br><span class="line">                                <span class="string">&#x27;number of training iterations.&#x27;</span>)</span><br><span class="line">    tf.app.flags.DEFINE_integer(<span class="string">&#x27;model_version&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;version number of the model.&#x27;</span>)</span><br><span class="line">    tf.app.flags.DEFINE_string(<span class="string">&#x27;work_dir&#x27;</span>, <span class="string">&#x27;/tmp&#x27;</span>, <span class="string">&#x27;Working directory.&#x27;</span>)</span><br><span class="line">    FLAGS = tf.app.flags.FLAGS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">_</span>):</span></span><br><span class="line">      <span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) &lt; <span class="number">2</span> <span class="keyword">or</span> sys.argv[-<span class="number">1</span>].startswith(<span class="string">&#x27;-&#x27;</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Usage: mnist_saved_model.py [--training_iteration=x] &#x27;</span></span><br><span class="line">              <span class="string">&#x27;[--model_version=y] export_dir&#x27;</span>)</span><br><span class="line">        sys.exit(-<span class="number">1</span>)</span><br><span class="line">      <span class="keyword">if</span> FLAGS.training_iteration &lt;= <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Please specify a positive value for training iteration.&#x27;</span>)</span><br><span class="line">        sys.exit(-<span class="number">1</span>)</span><br><span class="line">      <span class="keyword">if</span> FLAGS.model_version &lt;= <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Please specify a positive value for version number.&#x27;</span>)</span><br><span class="line">        sys.exit(-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">      <span class="comment"># Train model</span></span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;Training model...&#x27;</span>)</span><br><span class="line">      mnist = mnist_input_data.read_data_sets(FLAGS.work_dir, one_hot=<span class="literal">True</span>)</span><br><span class="line">      sess = tf.InteractiveSession()</span><br><span class="line">      serialized_tf_example = tf.placeholder(tf.string, name=<span class="string">&#x27;tf_example&#x27;</span>)</span><br><span class="line">      feature_configs = &#123;<span class="string">&#x27;x&#x27;</span>: tf.FixedLenFeature(shape=[<span class="number">784</span>], dtype=tf.float32),&#125;</span><br><span class="line">      tf_example = tf.parse_example(serialized_tf_example, feature_configs)</span><br><span class="line">      x = tf.identity(tf_example[<span class="string">&#x27;x&#x27;</span>], name=<span class="string">&#x27;x&#x27;</span>)  <span class="comment"># use tf.identity() to assign name</span></span><br><span class="line">      y_ = tf.placeholder(<span class="string">&#x27;float&#x27;</span>, shape=[<span class="literal">None</span>, <span class="number">10</span>])</span><br><span class="line">      w = tf.Variable(tf.zeros([<span class="number">784</span>, <span class="number">10</span>]))</span><br><span class="line">      b = tf.Variable(tf.zeros([<span class="number">10</span>]))</span><br><span class="line">      sess.run(tf.global_variables_initializer())</span><br><span class="line">      y = tf.nn.softmax(tf.matmul(x, w) + b, name=<span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">      cross_entropy = -tf.reduce_sum(y_ * tf.log(y))</span><br><span class="line">      train_step = tf.train.GradientDescentOptimizer(<span class="number">0.01</span>).minimize(cross_entropy)</span><br><span class="line">      values, indices = tf.nn.top_k(y, <span class="number">10</span>)</span><br><span class="line">      table = tf.contrib.lookup.index_to_string_table_from_tensor(</span><br><span class="line">          tf.constant([<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]))</span><br><span class="line">      prediction_classes = table.lookup(tf.to_int64(indices))</span><br><span class="line">      <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(FLAGS.training_iteration):</span><br><span class="line">        batch = mnist.train.next_batch(<span class="number">50</span>)</span><br><span class="line">        train_step.run(feed_dict=&#123;x: batch[<span class="number">0</span>], y_: batch[<span class="number">1</span>]&#125;)</span><br><span class="line">      correct_prediction = tf.equal(tf.argmax(y, <span class="number">1</span>), tf.argmax(y_, <span class="number">1</span>))</span><br><span class="line">      accuracy = tf.reduce_mean(tf.cast(correct_prediction, <span class="string">&#x27;float&#x27;</span>))</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;training accuracy %g&#x27;</span> % sess.run(</span><br><span class="line">          accuracy, feed_dict=&#123;</span><br><span class="line">              x: mnist.test.images,</span><br><span class="line">              y_: mnist.test.labels</span><br><span class="line">          &#125;))</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;Done training!&#x27;</span>)</span><br><span class="line"></span><br><span class="line">      <span class="comment"># Export model</span></span><br><span class="line">      <span class="comment"># WARNING(break-tutorial-inline-code): The following code snippet is</span></span><br><span class="line">      <span class="comment"># in-lined in tutorials, please update tutorial documents accordingly</span></span><br><span class="line">      <span class="comment"># whenever code changes.</span></span><br><span class="line">      export_path_base = sys.argv[-<span class="number">1</span>]</span><br><span class="line">      export_path = os.path.join(</span><br><span class="line">          tf.compat.as_bytes(export_path_base),</span><br><span class="line">          tf.compat.as_bytes(<span class="built_in">str</span>(FLAGS.model_version)))</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;Exporting trained model to&#x27;</span>, export_path)</span><br><span class="line">      builder = tf.saved_model.builder.SavedModelBuilder(export_path)</span><br><span class="line"></span><br><span class="line">      <span class="comment"># Build the signature_def_map.</span></span><br><span class="line">      classification_inputs = tf.saved_model.utils.build_tensor_info(</span><br><span class="line">          serialized_tf_example)</span><br><span class="line">      classification_outputs_classes = tf.saved_model.utils.build_tensor_info(</span><br><span class="line">          prediction_classes)</span><br><span class="line">      classification_outputs_scores = tf.saved_model.utils.build_tensor_info(values)</span><br><span class="line"></span><br><span class="line">      classification_signature = (</span><br><span class="line">          tf.saved_model.signature_def_utils.build_signature_def(</span><br><span class="line">              inputs=&#123;</span><br><span class="line">                  tf.saved_model.signature_constants.CLASSIFY_INPUTS:</span><br><span class="line">                      classification_inputs</span><br><span class="line">              &#125;,</span><br><span class="line">              outputs=&#123;</span><br><span class="line">                  tf.saved_model.signature_constants.CLASSIFY_OUTPUT_CLASSES:</span><br><span class="line">                      classification_outputs_classes,</span><br><span class="line">                  tf.saved_model.signature_constants.CLASSIFY_OUTPUT_SCORES:</span><br><span class="line">                      classification_outputs_scores</span><br><span class="line">              &#125;,</span><br><span class="line">              method_name=tf.saved_model.signature_constants.CLASSIFY_METHOD_NAME))</span><br><span class="line"></span><br><span class="line">      tensor_info_x = tf.saved_model.utils.build_tensor_info(x)</span><br><span class="line">      tensor_info_y = tf.saved_model.utils.build_tensor_info(y)</span><br><span class="line"></span><br><span class="line">      prediction_signature = (</span><br><span class="line">          tf.saved_model.signature_def_utils.build_signature_def(</span><br><span class="line">              inputs=&#123;<span class="string">&#x27;images&#x27;</span>: tensor_info_x&#125;,</span><br><span class="line">              outputs=&#123;<span class="string">&#x27;scores&#x27;</span>: tensor_info_y&#125;,</span><br><span class="line">              method_name=tf.saved_model.signature_constants.PREDICT_METHOD_NAME))</span><br><span class="line"></span><br><span class="line">      builder.add_meta_graph_and_variables(</span><br><span class="line">          sess, [tf.saved_model.tag_constants.SERVING],</span><br><span class="line">          signature_def_map=&#123;</span><br><span class="line">              <span class="string">&#x27;predict_images&#x27;</span>:</span><br><span class="line">                  prediction_signature,</span><br><span class="line">              tf.saved_model.signature_constants.DEFAULT_SERVING_SIGNATURE_DEF_KEY:</span><br><span class="line">                  classification_signature,</span><br><span class="line">          &#125;,</span><br><span class="line">          main_op=tf.tables_initializer(),</span><br><span class="line">          strip_default_attrs=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">      builder.save()</span><br><span class="line"></span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&#x27;Done exporting!&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">      tf.app.run()</span><br><span class="line">```    </span><br><span class="line">   </span><br><span class="line"></span><br><span class="line"><span class="number">2.</span> Deploy the model we have exported using TFserving</span><br><span class="line"></span><br><span class="line">```BASH</span><br><span class="line">docker run -p <span class="number">8500</span>:<span class="number">8500</span> \</span><br><span class="line">--mount <span class="built_in">type</span>=bind,source=$(pwd)/models/mnist,target=/models/mnist \</span><br><span class="line">-e MODEL_NAME=mnist -t tensorflow/serving</span><br></pre></td></tr></table></figure>
<ol start="3" type="1">
<li>run client</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip3 install tensorflow-serving-api</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 mnist_client.py --num_tests=<span class="number">1000</span> --server=<span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">8500</span></span><br></pre></td></tr></table></figure>
<ol start="4" type="1">
<li>result</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Inference error rate: 11.13%</span><br></pre></td></tr></table></figure>
<p>Client source code</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"></span><br><span class="line"><span class="comment"># This is a placeholder for a Google-internal import.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> grpc</span><br><span class="line"><span class="keyword">import</span> numpy</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> tensorflow_serving.apis <span class="keyword">import</span> predict_pb2</span><br><span class="line"><span class="keyword">from</span> tensorflow_serving.apis <span class="keyword">import</span> prediction_service_pb2_grpc</span><br><span class="line"><span class="keyword">import</span> mnist_input_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">tf.app.flags.DEFINE_integer(<span class="string">&#x27;concurrency&#x27;</span>, <span class="number">1</span>,</span><br><span class="line">                            <span class="string">&#x27;maximum number of concurrent inference requests&#x27;</span>)</span><br><span class="line">tf.app.flags.DEFINE_integer(<span class="string">&#x27;num_tests&#x27;</span>, <span class="number">100</span>, <span class="string">&#x27;Number of test images&#x27;</span>)</span><br><span class="line">tf.app.flags.DEFINE_string(<span class="string">&#x27;server&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;PredictionService host:port&#x27;</span>)</span><br><span class="line">tf.app.flags.DEFINE_string(<span class="string">&#x27;work_dir&#x27;</span>, <span class="string">&#x27;/tmp&#x27;</span>, <span class="string">&#x27;Working directory. &#x27;</span>)</span><br><span class="line">FLAGS = tf.app.flags.FLAGS</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">_ResultCounter</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line">  <span class="string">&quot;&quot;&quot;Counter for the prediction results.&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num_tests, concurrency</span>):</span></span><br><span class="line">    self._num_tests = num_tests</span><br><span class="line">    self._concurrency = concurrency</span><br><span class="line">    self._error = <span class="number">0</span></span><br><span class="line">    self._done = <span class="number">0</span></span><br><span class="line">    self._active = <span class="number">0</span></span><br><span class="line">    self._condition = threading.Condition()</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">inc_error</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">with</span> self._condition:</span><br><span class="line">      self._error += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">inc_done</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">with</span> self._condition:</span><br><span class="line">      self._done += <span class="number">1</span></span><br><span class="line">      self._condition.notify()</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">dec_active</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">with</span> self._condition:</span><br><span class="line">      self._active -= <span class="number">1</span></span><br><span class="line">      self._condition.notify()</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">get_error_rate</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">with</span> self._condition:</span><br><span class="line">      <span class="keyword">while</span> self._done != self._num_tests:</span><br><span class="line">        self._condition.wait()</span><br><span class="line">      <span class="keyword">return</span> self._error / <span class="built_in">float</span>(self._num_tests)</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">throttle</span>(<span class="params">self</span>):</span></span><br><span class="line">    <span class="keyword">with</span> self._condition:</span><br><span class="line">      <span class="keyword">while</span> self._active == self._concurrency:</span><br><span class="line">        self._condition.wait()</span><br><span class="line">      self._active += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_create_rpc_callback</span>(<span class="params">label, result_counter</span>):</span></span><br><span class="line">  <span class="string">&quot;&quot;&quot;Creates RPC callback function.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Args:</span></span><br><span class="line"><span class="string">    label: The correct label for the predicted example.</span></span><br><span class="line"><span class="string">    result_counter: Counter for the prediction result.</span></span><br><span class="line"><span class="string">  Returns:</span></span><br><span class="line"><span class="string">    The callback function.</span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">_callback</span>(<span class="params">result_future</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Callback function.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Calculates the statistics for the prediction result.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">      result_future: Result future of the RPC.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    exception = result_future.exception()</span><br><span class="line">    <span class="keyword">if</span> exception:</span><br><span class="line">      result_counter.inc_error()</span><br><span class="line">      <span class="built_in">print</span>(exception)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      sys.stdout.write(<span class="string">&#x27;.&#x27;</span>)</span><br><span class="line">      sys.stdout.flush()</span><br><span class="line">      response = numpy.array(</span><br><span class="line">          result_future.result().outputs[<span class="string">&#x27;scores&#x27;</span>].float_val)</span><br><span class="line">      prediction = numpy.argmax(response)</span><br><span class="line">      <span class="keyword">if</span> label != prediction:</span><br><span class="line">        result_counter.inc_error()</span><br><span class="line">    result_counter.inc_done()</span><br><span class="line">    result_counter.dec_active()</span><br><span class="line">  <span class="keyword">return</span> _callback</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">do_inference</span>(<span class="params">hostport, work_dir, concurrency, num_tests</span>):</span></span><br><span class="line">  <span class="string">&quot;&quot;&quot;Tests PredictionService with concurrent requests.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Args:</span></span><br><span class="line"><span class="string">    hostport: Host:port address of the PredictionService.</span></span><br><span class="line"><span class="string">    work_dir: The full path of working directory for test data set.</span></span><br><span class="line"><span class="string">    concurrency: Maximum number of concurrent requests.</span></span><br><span class="line"><span class="string">    num_tests: Number of test images to use.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Returns:</span></span><br><span class="line"><span class="string">    The classification error rate.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">  Raises:</span></span><br><span class="line"><span class="string">    IOError: An error occurred processing test data set.</span></span><br><span class="line"><span class="string">  &quot;&quot;&quot;</span></span><br><span class="line">  test_data_set = mnist_input_data.read_data_sets(work_dir).test</span><br><span class="line">  channel = grpc.insecure_channel(hostport)</span><br><span class="line">  stub = prediction_service_pb2_grpc.PredictionServiceStub(channel)</span><br><span class="line">  result_counter = _ResultCounter(num_tests, concurrency)</span><br><span class="line">  <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(num_tests):</span><br><span class="line">    request = predict_pb2.PredictRequest()</span><br><span class="line">    request.model_spec.name = <span class="string">&#x27;mnist&#x27;</span></span><br><span class="line">    request.model_spec.signature_name = <span class="string">&#x27;predict_images&#x27;</span></span><br><span class="line">    image, label = test_data_set.next_batch(<span class="number">1</span>)</span><br><span class="line">    request.inputs[<span class="string">&#x27;images&#x27;</span>].CopyFrom(</span><br><span class="line">        tf.contrib.util.make_tensor_proto(image[<span class="number">0</span>], shape=[<span class="number">1</span>, image[<span class="number">0</span>].size]))</span><br><span class="line">    result_counter.throttle()</span><br><span class="line">    result_future = stub.Predict.future(request, <span class="number">5.0</span>)  <span class="comment"># 5 seconds</span></span><br><span class="line">    result_future.add_done_callback(</span><br><span class="line">        _create_rpc_callback(label[<span class="number">0</span>], result_counter))</span><br><span class="line">  <span class="keyword">return</span> result_counter.get_error_rate()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>(<span class="params">_</span>):</span></span><br><span class="line">  <span class="keyword">if</span> FLAGS.num_tests &gt; <span class="number">10000</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;num_tests should not be greater than 10k&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  <span class="keyword">if</span> <span class="keyword">not</span> FLAGS.server:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;please specify server host:port&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  error_rate = do_inference(FLAGS.server, FLAGS.work_dir,</span><br><span class="line">                            FLAGS.concurrency, FLAGS.num_tests)</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&#x27;\nInference error rate: %s%%&#x27;</span> % (error_rate * <span class="number">100</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">  tf.app.run()</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

      <footer class="post-footer">

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/Logistic-Regression-and-Maximum-likelihood-estimation/2019/05/03/" rel="prev" title="Logistic Regression and Maximum likelihood estimation">
      <i class="fa fa-chevron-left"></i> Logistic Regression and Maximum likelihood estimation
    </a></div>
      <div class="post-nav-item">
    <a href="/Overfittingin-decision-trees/2019/05/11/" rel="next" title="Overfitting in decision trees">
      Overfitting in decision trees <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="valine-comments"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#docker-deployment"><span class="nav-number">1.</span> <span class="nav-text">Docker deployment</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#tfserving"><span class="nav-number">2.</span> <span class="nav-text">TFserving</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#deploy-docker-environment-of-tfserving"><span class="nav-number">2.1.</span> <span class="nav-text">Deploy docker environment of TFserving</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#download-example-code"><span class="nav-number">2.2.</span> <span class="nav-text">download example code</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#restful-api"><span class="nav-number">2.3.</span> <span class="nav-text">RESTful API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#gprc-api"><span class="nav-number">2.4.</span> <span class="nav-text">gPRC API</span></a></li></ol></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Ruochi Zhang</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">166</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">27</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zhangruochi" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhangruochi" rel="noopener" target="_blank"><i class="github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zrc720@gmail.com" title="E-Mail → mailto:zrc720@gmail.com" rel="noopener" target="_blank"><i class="envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>


  <div class="links-of-blogroll motion-element">
    <div class="links-of-blogroll-title"><i class="fa fa-link fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="http://www.healthinformaticslab.org/" title="http:&#x2F;&#x2F;www.healthinformaticslab.org" rel="noopener" target="_blank">HILab</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://www.shihaizhou.com/" title="http:&#x2F;&#x2F;www.shihaizhou.com" rel="noopener" target="_blank">Rose</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.csdn.net/cherish_CX/" title="https:&#x2F;&#x2F;blog.csdn.net&#x2F;cherish_CX&#x2F;" rel="noopener" target="_blank">Chunxia</a>
        </li>
    </ul>
  </div>

      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2019 – 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Ruochi Zhang</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="//cdn.jsdelivr.net/npm/algoliasearch@4/dist/algoliasearch-lite.umd.js"></script>
<script src="//cdn.jsdelivr.net/npm/instantsearch.js@4/dist/instantsearch.production.min.js"></script>
<script src="/js/algolia-search.js"></script>














  

  

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'qW3MLcAgcX96sB6qbegeL7rP-gzGzoHsz',
      appKey     : 'GL6JvT9DgGxqYrY5Vj6bXVuv',
      placeholder: "Thank you for your reply",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : 'en' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
